.container
  .row
    .col-md-8
      ol.breadcrumb
        li = link_to "HOME", root_path
        li = link_to @product.category.name.upcase, @product.category
        li.breadcrumb-title = link_to @product.title.upcase
.container
  .row
    .col-md-6
      = image_tag @product.image, class: 'img-responsive'
      br
      - if !@product.brand.nil?
        h2 Brand Name: #{link_to @product.brand.name, brand_path(@product.brand)}

    .col-md-6.itemDescription
      h1.itemTitle
        = @product.title
      .price.text-center
        = number_to_currency(@product.price,  unit: "₽ ", precision: 0)
      .itemP
        = @product.description.html_safe

      = simple_form_for @line_item do |f|
        - if @line_item.errors.any?
          #error_explanation
            h2
              = pluralize(@line_item.errors.count, "error")
              |  prohibited this product size from being saved:
            ul
              - @line_item.errors.full_messages.each do |msg|
                li= msg

        .col-md-10.col-md-offset-1
          - if @product.industry == "fashion"
            = render "industry_fashion", :f => f
            
          - elsif @product.industry == "cosmetic"
            = render "industry_cosmetic", :f => f
            
          - elsif @product.industry == "child"
            = render "industry_child", :f => f
            
          = f.input :product_id, as: :hidden, :input_html => { :value => @product.id } if @product.show_product_id?
        br
        br
        br
        
        .clr
        #add-to-cart-button
          - if @product.stock == 0 
            false
          - else
            = f.submit "Add to Cart", class: "itemAddToCard cd-popup-trigger"
          .cd-popup[role="alert"]
            .cd-popup-container
              .content.productGrowl
                .left
                  = image_tag(@product.image.medium, class: "img-responsive")
                .right
                  .inner
                    .title.h2
                      = @product.title.upcase
                    .price
                      = number_to_currency(@product.price,  unit: "₽ ", precision: 0)
                    p
                      strong
                        | Добавлено в корзину!
                    .cart_lnk
                      = link_to "Перейти в корзину", @cart
              .cd-popup-close
                = link_to "Close"
      .clr
      br
      br

.clr

.products
  hr

  #recommender_also_bought

  .clr
  hr

  #recommender_similer

  .clr
  hr

  #recommender_interesting

  .clr

javascript:
  var cf_also_bought = function(data){
    // jQuery code
    if(data.length > 0) {
      $.ajax({
        type: "POST",
        url: 'products_urls',
        data: {ids: data, recommender: 'also_bought'},
      });
      return false;
    } else {
      console.log("Not work or id nil")
      var url = 'products_urls';
      $.ajax({
        type: "POST",
        url: 'products_urls',
        data: {ids: data, recommender: 'also_bought'},
      });
    }
  };

  var cf_similer = function(data){
    // jQuery code
    if(data.length > 0) {
      $.ajax({
        type: "POST",
        url: 'products_urls',
        data: {ids: data, recommender: 'similar'},
      });
      return false;
    } else {
      console.log("Not work or id nil, similar")
      $.ajax({
        type: "POST",
        url: 'products_urls',
        data: {ids: data, recommender: 'similar'},
      });
    }
  };

  var cf_interesting = function(data){
    // jQuery code
    if(data.length > 0) {
      var url = 'products_urls';
      $.ajax({
        type: "POST",
        url: 'products_urls',
        data: {ids: data, recommender: 'interesting'},
      });
      return false;
    }
  };

  function afterInitRees46() {
    var cart_product_ids = '#{ProductsInfo.new(@cart.line_items).product_ids_in_cart.to_json.html_safe}'
    //console.log("#{@product.stock?}")
    console.log("#{@product.available?}")
    REES46.addReadyListener(function () {
      REES46.pushData('view', {
        item_id: '#{@product.id}',
        price: '#{@product.price}',
        is_available: '#{@product.available?}',
        categories: '#{@product.category_id}'
      });
    });

    REES46.addReadyListener(function () {
      $('#add-to-cart-button').click(function () {
        REES46.pushData('cart', {
          item_id: '#{@product.id}',
          price: '#{@product.price}',
          is_available: '#{@product.available?}',
          categories: '#{@product.category_id}'
        });
      });
    });

    REES46.addReadyListener(function () {
      REES46.recommend({
        recommender_type: 'also_bought',
        item: '#{@product.id}',
        cart: JSON.parse(cart_product_ids).map(function(el){
          return el.cart
        }),
        limit: 4,
        modification: '#{@product.category.human_categories_industry}'
        }, cf_also_bought);
    });
    console.log('#{@product.category.human_categories_industry}')
    REES46.addReadyListener(function () {
      REES46.recommend({
        recommender_type: 'interesting',
        item: '#{@product.id}',
        cart: JSON.parse(cart_product_ids).map(function(el){
          return el.cart
        }),
        limit: 4,
        modification: '#{@product.category.human_categories_industry}'
        }, cf_interesting);
    });

    REES46.addReadyListener(function () {
      REES46.recommend({
        recommender_type: 'similar',
        item: '#{@product.id}',
        cart: JSON.parse(cart_product_ids).map(function(el){
          return el.cart
        }),
        //categories: ['#{@product.category_id}'],
        limit: 4,
        modification: '#{@product.category.human_categories_industry}'
        }, cf_similer);
    });
  }
