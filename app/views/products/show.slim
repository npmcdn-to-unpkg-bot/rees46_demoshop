.container
  .row
    .col-xs-5
      hr
      = link_to "Home > ", root_path
      = @product.gender
      hr
      = image_tag @product.image, class: 'img-responsive'
      br
      h3 Brand Name:
      - if !@product.brand.nil?
        = link_to @product.brand.name, brand_path(@product.brand)

    .col-xs-4
      h1= @product.title
      = @product.description.html_safe
      = simple_form_for @line_item do |f|
        - if @line_item.errors.any?
          #error_explanation
            h2
              = pluralize(@line_item.errors.count, "error")
              |  prohibited this product size from being saved:
            ul
              - @line_item.errors.full_messages.each do |msg|
                li= msg
        .col-md-3
        - if @product.industry == "fashion"
          = render "industry_fashion", :f => f
          
        - elsif @product.industry == "cosmetic"
          = render "industry_cosmetic", :f => f
          
        - elsif @product.industry == "child"
          = render "industry_child", :f => f
          
        = f.input :product_id, as: :hidden, :input_html => { :value => @product.id } if @product.show_product_id?

        / h4.col-md-4
        /   = number_to_currency(@product.price,  unit: "â‚½ ")
        / .text-right
        /   = print_stock(@product.stock ) + " "
        /   - if @product.stock == 0
        /     false
        /   - else
        /     = @product.stock
          br
          br
          #add-to-cart-button
            - if @product.stock == 0 
              false
            - else
              = f.submit "Add to Cart"
      .clr
      br
      br

.clr
hr

#recommender_also_bought

.clr
hr

#recommender_similer

.clr
hr

#recommender_interesting

.clr
hr
javascript:
  var cf_also_bought = function(data){
    // jQuery code
    if(data.length > 0) {
      $.ajax({
        type: "POST",
        url: 'products_urls',
        data: {ids: data, recommender: 'also_bought'},
      });
      return false;
    } else {
      console.log("Not work or id nil")
      var url = 'products_urls';
      $.ajax({
        type: "POST",
        url: 'products_urls',
        data: {ids: data, recommender: 'also_bought'},
      });
    }
  };

  var cf_similer = function(data){
    // jQuery code
    if(data.length > 0) {
      $.ajax({
        type: "POST",
        url: 'products_urls',
        data: {ids: data, recommender: 'similar'},
      });
      return false;
    } else {
      console.log("Not work or id nil, similar")
      $.ajax({
        type: "POST",
        url: 'products_urls',
        data: {ids: data, recommender: 'similar'},
      });
    }
  };

  var cf_interesting = function(data){
    // jQuery code
    if(data.length > 0) {
      var url = 'products_urls';
      $.ajax({
        type: "POST",
        url: 'products_urls',
        data: {ids: data, recommender: 'interesting'},
      });
      return false;
    }
  };

  function afterInitRees46() {
    var cart_product_ids = '#{ProductsInfo.new(@cart.line_items).product_ids_in_cart.to_json.html_safe}'
    //console.log("#{@product.stock?}")
    console.log("#{@product.available?}")
    REES46.addReadyListener(function () {
      REES46.pushData('view', {
        item_id: '#{@product.id}',
        price: '#{@product.price}',
        is_available: '#{@product.available?}',
        categories: '#{@product.category_id}'
      });
    });

    REES46.addReadyListener(function () {
      $('#add-to-cart-button').click(function () {
        REES46.pushData('cart', {
          item_id: '#{@product.id}',
          price: '#{@product.price}',
          is_available: '#{@product.available?}',
          categories: '#{@product.category_id}'
        });
      });
    });

    REES46.addReadyListener(function () {
      REES46.recommend({
        recommender_type: 'also_bought',
        item: '#{@product.id}',
        cart: JSON.parse(cart_product_ids).map(function(el){
          return el.cart
        }),
        limit: 4,
        modification: '#{@product.category.human_categories_industry}'
        }, cf_also_bought);
    });
    console.log('#{@product.category.human_categories_industry}')
    REES46.addReadyListener(function () {
      REES46.recommend({
        recommender_type: 'interesting',
        item: '#{@product.id}',
        cart: JSON.parse(cart_product_ids).map(function(el){
          return el.cart
        }),
        limit: 4,
        modification: '#{@product.category.human_categories_industry}'
        }, cf_interesting);
    });

    REES46.addReadyListener(function () {
      REES46.recommend({
        recommender_type: 'similar',
        item: '#{@product.id}',
        cart: JSON.parse(cart_product_ids).map(function(el){
          return el.cart
        }),
        //categories: ['#{@product.category_id}'],
        limit: 4,
        modification: '#{@product.category.human_categories_industry}'
        }, cf_similer);
    });
  }
