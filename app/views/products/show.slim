.container
  .row
    .col-md-8
      ol.breadcrumb
        li = link_to t('product.root_path'), root_path
        - if !@product.category.nil?
          li = link_to @product.category.root.name.upcase, category_path(@category.root)
        - if !@product.category.nil?
          li= link_to @product.category.name, category_path(@category)
        li.breadcrumb-title = @product.title.upcase

  .row
    .col-md-6
      = image_tag @product.image, class: 'img-responsive show-img'

    .col-md-6
      .product-title 
        h1= @product.title
      .price
        = number_to_currency(@product.price,  unit: "₽ ", precision: 0)
      = simple_form_for @line_item, remote: true do |f|
        .col-md-10.remove_padding
          #errors_log
            - if @line_item.errors.any?
              #error_explanation
                h2
                  = pluralize(@line_item.errors.count, "error")
                  |  prohibited this product size from being saved:
                ul
                  - @line_item.errors.full_messages.each do |msg|
                    li= msg
          - if @product.industry == "fashion"
            = render "industry_fashion", :f => f
            
          - elsif @product.industry == "cosmetic"
            = render "industry_cosmetic", :f => f
            
          - elsif @product.industry == "child"
            = render "industry_child", :f => f

          = f.input :product_id, as: :hidden, :input_html => { :value => @product.id } if @product.show_product_id?
          br
            #add-to-cart-button
              - if @product.stock == 0 
                false
              - else
                = f.submit t('simple_form.add_to_cart'), class: "btn btn-success count_cart"
              #server_msg_modal.modal.fade
                .modal-dialog
                  .modal-content
                    .modal-header
                      button.close[type="button" data-dismiss="modal" aria-label="Close"]
                        span[aria-hidden="true"]
                          | ×
                      h4.modal-title
                        = @product.title.upcase
                    .modal-body
                      .row
                        .col-sm-6
                          = image_tag(@product.image.medium, class: "img-fit")
                        .col-sm-6
                          = @product.title.upcase
                          = number_to_currency(@product.price,  unit: "₽ ", precision: 0)
                          h1= link_to "Перейти в корзину", @cart, class: "cart_link"
.products
  #recommender_also_bought
  .clr
  #recommender_interesting
  .clr
  #recommender_similar
  .clr

javascript:
  var cf_also_bought = function(data){
    if(data.length > 0) {
      $.ajax({
        type: "POST",
        url: 'products_recommender',
        data: {ids: data, recommender: 'also_bought'},
      });
      return false;
    } else {
      console.log("Check why not work also_bought")
    }
  };

  var cf_interesting = function(data){
    if(data.length > 0) {
      $.ajax({
        type: "POST",
        url: 'products_recommender',
        data: {ids: data, recommender: 'interesting'},
      });
      return false;
    } else {
      console.log("Check why not work interesting")
    }
  };

  var cf_similar = function(data){
    if(data.length > 0) {
      $.ajax({
        type: "POST",
        url: 'products_recommender',
        data: {ids: data, recommender: 'similar'},
      });
      return false;
    } else {
      console.log("Check why not work similar")
    }
  };

  function afterInitRees46() {
    var cart_product_ids = '#{ProductsInfo.new(@cart.try(:line_items) || []).product_ids_in_cart.to_json.html_safe}'

    REES46.addReadyListener(function () {
      REES46.pushData('view', {
        item_id: '#{@product.id}',
        price: '#{@product.price}',
        is_available: '#{@product.available?}',
        categories: '#{@product.category_id}'
      });
    });

    REES46.addReadyListener(function () {
      $('#add-to-cart-button').click(function () {
        REES46.pushData('cart', {
          item_id: '#{@product.id}',
          price: '#{@product.price}',
          is_available: '#{@product.available?}',
          categories: '#{@product.category_id}'
        });
      });
    });

    REES46.addReadyListener(function () {
      REES46.recommend({
        recommender_type: 'also_bought',
        item: '#{@product.id}',
        cart: JSON.parse(cart_product_ids).map(function(el){
          return el.cart
        }),
        limit: 24,
        modification: '#{@product.category.try(:human_categories_industry)}'
        }, cf_also_bought);
    });

    REES46.addReadyListener(function () {
      REES46.recommend({
        recommender_type: 'interesting',
        item: '#{@product.id}',
        cart: JSON.parse(cart_product_ids).map(function(el){
          return el.cart
        }),
        limit: 24,
        modification: '#{@product.category.try(:human_categories_industry)}'
        }, cf_interesting);
    });

    REES46.addReadyListener(function () {
      console.log('#{@product.category_id}')
      REES46.recommend({
        recommender_type: 'similar',
        item: '#{@product.id}',
        cart: JSON.parse(cart_product_ids).map(function(el){
          return el.cart
        }),
        categories: '#{@product.category_id}',
        limit: 24,
        modification: '#{@product.category.try(:human_categories_industry)}'
        }, cf_similar);
    });
  }
